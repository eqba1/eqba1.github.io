<!doctype html>
<html lang="fa-IR">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>eqba1 |  کوک کردن هسته لینوکس با استفاده از sysctl</title>
  <meta name="description" content=" اگرچه هسته لینوکس به شکلی کاملا ایمن طراحی شده است. اما باز روش هایی برای محکم کاری در آن وجود دارد. انجام این کار در صورتی که بدانیم چه میخواهیم بسیار ساده است. محکم سازی هسته میتواند از برخی حملات مرسوم شبکه و نشت اطلاعات جلوگیری به عمل آورد. البته برای این کار نیازی به کامپایل دوباره هسته یا کرنل نیست. ">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content=" کوک کردن هسته لینوکس با استفاده از sysctl">
  <meta property="og:locale" content="fa_IR">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://eqba1.github.com/posts/tuning-linux-kernel-with-sysctl">
  <meta property="og:description" content=" اگرچه هسته لینوکس به شکلی کاملا ایمن طراحی شده است. اما باز روش هایی برای محکم کاری در آن وجود دارد. انجام این کار در صورتی که بدانیم چه میخواهیم بسیار ساده است. محکم سازی هسته میتواند از برخی حملات مرسوم شبکه و نشت اطلاعات جلوگیری به عمل آورد. البته برای این کار نیازی به کامپایل دوباره هسته یا کرنل نیست. ">
  <meta property="og:site_name" content="eqba1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://eqba1.github.com/posts/tuning-linux-kernel-with-sysctl">
  <meta name="twitter:title" content=" کوک کردن هسته لینوکس با استفاده از sysctl">
  <meta name="twitter:description" content=" اگرچه هسته لینوکس به شکلی کاملا ایمن طراحی شده است. اما باز روش هایی برای محکم کاری در آن وجود دارد. انجام این کار در صورتی که بدانیم چه میخواهیم بسیار ساده است. محکم سازی هسته میتواند از برخی حملات مرسوم شبکه و نشت اطلاعات جلوگیری به عمل آورد. البته برای این کار نیازی به کامپایل دوباره هسته یا کرنل نیست. ">

  
  

  <link href="https://eqba1.github.com/feed.xml" type="application/rss+xml" rel="alternate" title="eqba1 Last 10 blog posts" />

  
    <link rel="stylesheet" type="text/css" href="/assets/fonts-85dab368d056b5d66418fbfd7e55a89f34f644ee811c8218c81017204426121b.css">
  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-light-22d5f414b6b2b0e2a42052932d4072b318a93ce20817d6d013d84e685fcad8f1.ico">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-light-9711c1d41ea4a8ffba275758ecd2d83d95acc8365492a9512be21617a8c49fd1.png">
      <link rel="stylesheet" type="text/css" title="light" id="light" href="/assets/light-2f2b42b207b89420eab7874550c9835cd6bb72d97df89f972ee9e0f66364b9b5.css">
      <link rel="stylesheet" type="text/css" title="dark" id="dark" href="/assets/dark-7b4a340492b76144450a56aea5681218d9df0a8e0437f31fca997b5ac1470256.css" disabled="true">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="eqba1">eqba1</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about" xlink:href="/assets/about-ecf154b571ab8034ae00aeed91a3b7ad68db80b46d958753ad6216c919486e88.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/_eqba1" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://github.com/eqba1" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="https://instagram.com/_eqba1" rel="noreferrer noopener" target="_blank" title="Instagram">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-instagram">
  <use href="/assets/instagram-37f85bc75b43ecc4c114d9a46f846327fe13c5893787c6afbcfef9d30d58bd9e.svg#icon-instagram" xlink:href="/assets/instagram-37f85bc75b43ecc4c114d9a46f846327fe13c5893787c6afbcfef9d30d58bd9e.svg#icon-instagram"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss" xlink:href="/assets/rss-541ec5cea9cefd10d2fcfec01888f3f231a8829940249835fa7b7b3a12ae0d0d.svg#icon-rss"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a onclick="toggle()" title="Toggle Theme">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-theme">
  <use href="/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme" xlink:href="/assets/theme-66869e0bf8dab34bae1c86bda400327b772e0be69e8dc28d3ede896e771320ed.svg#icon-theme"></use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>



        <div id="align-right">
          <article class="article scrollappear">
            <header class="article-header ">
              <h1> کوک کردن هسته لینوکس با استفاده از sysctl</h1>
              <p> اگرچه هسته لینوکس به شکلی کاملا ایمن طراحی شده است. اما باز روش هایی برای محکم کاری در آن وجود دارد. انجام این کار در صورتی که بدانیم چه میخواهیم بسیار ساده است. محکم سازی هسته میتواند از برخی حملات مرسوم شبکه و نشت اطلاعات جلوگیری به عمل آورد. البته برای این کار نیازی به کامپایل دوباره هسته یا کرنل نیست. </p>
              <div class="article-list-footer">
  <span class="article-list-date">
    October 15, 2020
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      9 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/linux" title="See all posts with tag 'Linux'">Linux</a>
    
      
      <a href="/tag/operating-system" title="See all posts with tag 'Operating System'">Operating System</a>
    
      
      <a href="/tag/security" title="See all posts with tag 'Security'">Security</a>
    
  </div>
</div>
            </header>

            <div class="article-content ">
              <p>موضوعاتی که در این بخش بررسی میکنیم:</p>

<ul>
  <li>درک صحیح از فایل سیستم proc/</li>
  <li>تنظیم کردن پارامترهای کرنل با sysctl</li>
  <li>پیکربندی فایل sysctl.conf</li>
  <li>آشنایی با ASLR</li>
  <li>شناسایی با استفاده از ping</li>
</ul>

<p><a href="/assets/documentation/Tuning@2x-f2843be981422b943845b9986a44a0162cd0f1d20bfa8eeb5b5cd68d2424ff8f.jpg">
  <img src="/assets/documentation/Tuning-4c1322d8737f03c8de20b8bdba54ee8ff00dca22fc27d21f5f9c800bb96bcbe5.jpg" alt="madule 1" class="zooming" data-rjs="/assets/documentation/Tuning@2x-f2843be981422b943845b9986a44a0162cd0f1d20bfa8eeb5b5cd68d2424ff8f.jpg" data-zooming-width="1220" data-zooming-height="686" />
</a></p>

<h2 id="فایل-سیستم-proc">فایل سیستم proc</h2>
<p>شبه فایل سیستم<code class="highlighter-rouge">proc</code>که  در سیستم های لینوکسی در مسیر<code class="highlighter-rouge">/proc</code>مستقر شده است. وضعیت جاری سیستم  و آنچه که در سیستم در حال اتفاق می باشد را در خود دارد. دلیل شبه فایل سیستم بودن این دایرکتوری این است که در حالت کلی این دایرکتوری وجود ندارد و محتوای آن صرفاً در سیستم در حال اجرا وجود دارد و بعد از خاموش شدن سیستم محتوایش پاک سازی می‌شود. اکثر فایل های موجود در این دایرکتوری فقط خواندنی هستند و قابلیت تغییر ندارند. اما برخی از این فایلها که در این ماژول به آن می‌پردازیم قابل تغییر هستند و در تغییر یکسری از پارامترهای هسته سیستم عامل کمک می‌کنند. برای بهتر دیدن این فایل سیستم فایل<code class="highlighter-rouge">mount</code>در مسیر<code class="highlighter-rouge">/proc/self/mounts</code>نگاهی می اندازیم. این فایل حاوی اطلاعات تمام فایل سیستم های مستقر شده در سیستم است برای دیدن محتوا از دستور زیر میتوان استفاده کرد :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span><span class="nb">cat</span> /proc/self/mounts </code></pre></figure>

<p>بعد از باز کردن فایل مشخص است محتوای زیادی وجود دارد. برای دیدن فایل سیستم<code class="highlighter-rouge">proc</code>میتوان از دستور<code class="highlighter-rouge">grep</code>استفاده کرد</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span><span class="nb">grep</span> “^proc”  /proc/self/mount </code></pre></figure>

<p>دانستیم که این فایل سیستم مجازی است و اکثر فایلها به صورت مجازی در این مسیر قرار دارند. سوالی که پیش می آید اطلاعات درون این فایل سیستم از کجا است ؟ بیشتر فایلها این فایل سیستم به صورت لینک به چندین فایل دیگر در فایل سیستم های دیگر هستند که هر بار سیستم بالا بیاید یک پیوند در این مسیر ایجاد میکنند. ( البته این موضوع فعلا در همین حد مورد بحث قرار گرفته و مبحث پیوند ها و اینکه چرا این موارد وجود دارد در ماژول های دیگر لینوکس مورد بحث قرار میگیرد. صرفا در اینجا جهت نگاه کلی به این فایل سیستم گفته می‌شود )‌ برای اینکه متوجه شوم که فایل های موجود به چه فایل های دیگری پیوند شده‌اند می‌توانیم از دستور 	<code class="highlighter-rouge">find</code>استفاده کنیم:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">$ </span>find <span class="nt">-L</span> /etc /proc <span class="nt">-maxdepth</span> 1 <span class="nt">-samefile</span> /proc/self/mounts </code></pre></figure>

<p>این دستور در مسیر های<code class="highlighter-rouge">/etc/</code>و<code class="highlighter-rouge">/proc</code>به دنبال لینکها یا پیوند های که فایل mounts از آنها بهره می برد جستجو میکند البته تنها با عمق ۱ دایرکتوری.</p>

<p>برای یادگیری بیشتر درباره این فایل سیستم مجازی شما را به صفحه راهنمای کامل که در خود لینوکس وجود دارد ارجاع میدهم :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span>man 5 proc </code></pre></figure>

<h2 id="پیکربندی-پارامترها">پیکربندی پارامترها</h2>

<p>پارامترهای که برای تنظیم هسته استفاده میشود در مسیر<code class="highlighter-rouge">/proc/sys</code>قرار دارند. تنظیمات بسیاری که هر کدام در بخش های مختلف این مسیر وجود دارند. برای اینکه بتوان به صورت کلی مسیرها و فایل ها را یافت و  شناخت، میتوان از دستور<code class="highlighter-rouge">tree</code>استفاده کرد.</p>

<p>اگر دستور<code class="highlighter-rouge">tree</code>را در سیستم خود نصب ندارید. با استفاده از دستور زیر  ابزار را نصب کنید.( این دستور صرفا برای سیستم عاملهای بر پایه Debian است برای سایر سیستم ها میتواند متفاوت باشد )‌</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install </span>tree  </code></pre></figure>

<p>بعد از نصب ابزار با استفاده از امکانات این آن میتوان ایده کلی از ساختار دایرکتوری ها بدست آورد. برای نمونه اگر بخواهیم سطح اول از ساختار این دایرکتوری را مشاهده کنیم به شکل زیر از ابزار استفاده می‌کنیم :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span>tree <span class="nt">-L</span> 1  /proc/sys
/proc/sys
├── abi
├── debug
├── dev
├── fs
├── kernel
├── net
├── user
└── vm

8 directories, 0 files</code></pre></figure>

<p>با استفاده از دستور فوق میتوان شناخت کافی از مسیرها و پارامترهای که میتوان برای کرنل تنظیم کرد بدست آورد. برای مثال ما قصد داریم<code class="highlighter-rouge">NIS domainname</code>هسته سیستم عامل را تغییر دهیم. البته  این نکته را ذکر کنم<code class="highlighter-rouge">NIS domain name</code>با<code class="highlighter-rouge">DNS</code>متفاوت است و ارتباطی بین این شباهت اسمی ها وجود ندارد. برای خواندن مقدار تعیین شده برای این پارامتر. داریم:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span><span class="nb">cat</span> /proc/sys/kernel/domainname
<span class="o">(</span>none<span class="o">)</span></code></pre></figure>

<p>در این مثال مقدار پارامتر<code class="highlighter-rouge">(none)</code>است. برای تغییر مقدار آن می‌توان از خود فایل سیستم استفاده کرد. برای سادگی کار  با این فایل ها دستوری به اسم<code class="highlighter-rouge">sysctl</code>طراحی شده است. برای نمونه در قبل دیدیم که با استفاده از دستور<code class="highlighter-rouge">tree</code>میتوان ساختار فایلها و پارامترها را دید اما برای سادگی میتوان با استفاده از دستور زیر کل پارامتر ها را به شکل لیست شده مشاهده کرد :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span>sysctl <span class="nt">-a</span> </code></pre></figure>

<p>در صورتی که بخواهیم دنبال یک پارامتر خاص بگردیم از آپشن<code class="highlighter-rouge">r</code>مخفف<code class="highlighter-rouge">regular expression ‍</code>استفاده میکنیم. برای مثال بخواهیم دنبال پارامتر domainname بگردیم در ترمینال وارد میکنیم:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span>sysctl <span class="nt">-ar</span> domainname </code></pre></figure>

<p>همچنین اگر فقط نیاز به مقدار یا<code class="highlighter-rouge">Value</code>پارامتر داریم از آپشن<code class="highlighter-rouge">n ‍</code>استفاده می‌کنیم :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span>sysctl <span class="nt">-anr</span> domainname </code></pre></figure>

<p>حال توانستیم مقادیر هر پارامتر را بخوانیم و پیدا کنیم. برای تغییر آنها چه باید بکنیم؟ میتوان از خود فایل سیستم استفاده کرد و به صورت مستقیم مقادیر را تغییر داد به این صورت :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span><span class="nb">echo</span> “example” | <span class="nb">sudo tee</span> /proc/sys/kernel/domainname</code></pre></figure>

<p>اما این روش مرسوم نیست و بهتر است از دستور<code class="highlighter-rouge">sysctl</code>استفاده کنیم. با استفاده از اپشن<code class="highlighter-rouge">w</code>میتوان این عمل را انجام داد. البته باید به این موضوع توجه کرد که تغییر مقادیر هر یک از این پارامترها نیاز به دسترسی ادمین دارد و باید از<code class="highlighter-rouge">sudo</code>استفاده کنیم :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span><span class="nb">sudo </span>sysctl <span class="nt">-w</span> kernel.domainname<span class="o">=</span>’example’</code></pre></figure>

<p>مشخص است که نوشتن اطلاعات به این شیوه در یک دایرکتوری مجازی صرفا تا زمانی که سیستم روشن باشد باقی خواهد ماند و مانند همان فایل /proc/sys/mount هر کدام از این پارامتر ها اطلاعات تغییر کرده خود را باید از یک فایل در فایل سیستم اصلی بگیرند. برای این موضوع در دایرکتوری<code class="highlighter-rouge">etc</code>مسیری به اسم<code class="highlighter-rouge">sysctl.d</code>وجود دارد. که در صورتی بخواهیم تنظیمات باقی بماند را در این بخش با استفاده از ساختن یک فایل، مقدار پارامتر را ذخیره می‌کنیم. برای نمونه بار تغییر مقدار NIS domainname را به example . یک فایل در مسیر<code class="highlighter-rouge">/etc/sysctl.d</code>ایجاد کرده و مقدار پارامتر مورد نظر را در آن قرار میدهیم برای این کار، داریم :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span><span class="nb">echo</span> ‘kernel.domainname<span class="o">=</span>example’ | <span class="nb">sudo tee</span> /etc/sysctl.d/60-nis-domain.conf</code></pre></figure>

<blockquote>
  <p>اگر در فایل های این دایرکتوری دقیق تر شویم می بینیم که هر کدام از فایل ها در اول اسم خود یک عدد از بازه ۱۰ تا ۹۹ دارند که اولویت اجرای هر کدام را به ما نشان میدهد. تا بتوانم هر کدام که میخواهیم سریع تر  تنظیم شود را با شماره مورد نظر خود پیکربندی کنیم. در اینجا ما از عدد 60 استفاده کرده ایم.</p>
</blockquote>

<p>حال ما فقط یک فایل با مقدار مورد نظرمان ساختیم اما اگر مقدار پارامتر را نگاه کنیم تغییر نکرده است! علت این است که این فایلها زمانی که سیستم boot شود load میشوند. اگر بخواهیم در  لحظه مقدار را به آنچه در فایلها نوشته ایم تغییر دهیم با استفاده از آپشن<code class="highlighter-rouge">p</code>میتوانیم تمام پارامترهای تعیین شده در این دایرکتوری را مشخص کرد. برای نمونه در مثال ما به صورت زیر خواهد بود :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">$ </span><span class="nb">sudo </span>sysctl <span class="nt">-p</span> </code></pre></figure>

<p>همچنین برای خواندن مقدار یک فایل خاص و تنظیم یک پارامتر خاص می‌توان اسم فایل را به عنوان ورودی تعیین کرد :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">$ </span><span class="nb">sudo </span>sysctl <span class="nt">-p</span> /etc/sysctl.d/60-nis-domain.conf</code></pre></figure>

<p>همچنین اگر بخواهیم کل پارامتر های سیستم دوباره از نو مقداردهی شوند نیز از آپشن ‍<code class="highlighter-rouge">system ‍</code>استفاده میکنیم :‌</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span><span class="nb">sudo </span>sysctl <span class="nt">--system</span></code></pre></figure>

<h2 id="address-space-layout-randomization">Address Space Layout Randomization</h2>
<p>مخفف عبارت بالا را با ASLR می شناسیم. این اسم ما را به یک قابلیت هسته لینوکس ارجاع میدهد که در سال ۲۰۰۵ اضافه شده است. وجود این ویژگی تضمین این موضوع در سیستم عامل است که محل قرارگیری اطلاعات باینری حاصل از یک برنامه سیستم در حافظه موقت به زمان اجرای آن نیز بستگی داشته باشد و تصادفی بودن آدرس خانه های هر دستور را هرچند تکراری باشد تصادفی ایجاد میکند. شاید این موضوع در نگاه اول خیلی اهمیت نداشته باشه اما برای تخریبگران و کسانی که به دنبال کوچک ترین راهی برای دسترسی گرفتن از سیستم هستن یک موصوع بسیار جدی است و می‌تواند باعث باگ‌های حیاتی در سیستم شود. حال این ASLR در هسته لینوکس وجود دارد اما دلیل بر فعال بودن آن نیست. هرچند در همه سیستم ها به صورت پیشفرض فعال است ولی گاهاً میتواند غیر فعال باشد، برای اطمینان از کارکرد این قابلیت از دستور<code class="highlighter-rouge">sysctl</code>استفاده میکنیم.</p>

<p>پرامتر مورد نظر همان طور که از نام ASLR مشخص است باید چیزی شبیه  randomize_va_space باشد. همانطور که قبلا اشاره کردیم برای دیدن مقدار پارامتر با استفاده از دستور sysctl به صورت زیر عمل می‌کنیم :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span>sysctl <span class="nt">-ar</span> randomize_va_space
kernel.randomize_va_space <span class="o">=</span> 2</code></pre></figure>

<blockquote>
  <p>این اسم ها را از کجا پیدا کنیم؟ همان طور که در اول این مقاله اشاره شد باید بدانیم از کرنل چه میخواهیم و قصد تغییر چه پارامترهای از سیستم را داریم. در صورتی که بدانیم میخواهیم ASLR را تغییر دهیم پیدا کردن اسم randomize کار چندان سختی نخواهد بود.</p>
</blockquote>

<p>در خروجی دستور بالا مشاهده میکنید که مقدار این پارامتر 2 است یعنی به این قابلیت کرنل فعال است و نگرانی از این بابت سیستم ما را تهدید نمی‌کند. می‌توان برای تست کردن و اطمینان از صحت کارکرد مقدار این پارامتر را به صفر تغییر داد. در این صورت این قابلیت غیرفعال خواهد شد. چطور متوجه شویم؟</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span><span class="nb">sudo </span>sysctl <span class="nt">-w</span> kernel.randomize_va_space<span class="o">=</span>0
kernel.randomize_va_space <span class="o">=</span> ۰</code></pre></figure>

<p>دستور<code class="highlighter-rouge">ldd</code>را برای یک دستور مانند<code class="highlighter-rouge">/bin/bash/</code>اجرا میکنم در خروجی این دستور آدرس حافظه برنامه که در اینجا bash هست را برگشت خواهد داد. در صورتی که قابلیت ASLR خاموش باشد و چند 
بار دستور ldd را اجرا کنیم. مشاهده میشود که آدرس های یکسانی از حافظه را نشان خواهد داد.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> <span class="nv">$ </span>ldd /bin/bash
	linux-vdso.so.1 <span class="o">(</span>0x00007ffff7fce000<span class="o">)</span>
	…
<span class="nv">$ </span> ldd /bin/bash
	linux-vdso.so.1 <span class="o">(</span>0x00007ffff7fce000<span class="o">)</span>
	…
<span class="nv">$ </span>ldd /bin/bash
	linux-vdso.so.1 <span class="o">(</span>0x00007ffff7fce000<span class="o">)</span>
	…</code></pre></figure>

<p>پس بهتر است برای جلوگیری از همچین مسله خطرناکی از تنظیم شدن پارامتر ASLR اطمینان حاص کنیم.</p>

<h2 id="پکتهای-icmp">پکتهای ICMP</h2>

<p>همانطور که در ابتدای مقاله نیز اشاره شد میتوان با تنظیم کردن هسته لینوکس سیستم را از تهدیدهای سمت شبکه نیز محافظت کرد البته به روشی بسیار سخت گیرانه و غیر قابل دور زدن. برای مثال یک از پارامترهای هسته لینوکس تنظیم مجوز ورود پکت‌ها است. پکت ICMP  که میتوان جهت شناسایی سیستم های که به این پکت پاسخ میدهند استفاده کرد . در صورتی که یک تخریبگر در شبکه وجود داشته باشد میتواند با ارسال این پکت به سادگی سیستم لینوکسی را یافته و شروع به حملات دیگر کند. برای جلوگیری از این اقدام میتوان از دیوارهای آتش نیز بهره برد اما مطمئن ترین روش استفاده از پارامتر های هسته سیستم عامل است.</p>

<p>این قابلیت به صورت پیشفرض برای حالت broadcast در سیستم‌های لینوکسی غیر فعال است اما در حالت unicast نیاز به غیر فعال کردن دارد. پس در اینجا با یک مثال واقعی از غیر فعال کردن پارامترها سروکار داریم. برای دیدن مقدار پارمتر کافی است صرفا نوع پکت را به دستور sysctl بدهیم و پارامتری که میخواهیم تغییر دهیم را شناسایی کنیم  :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="nv">$ </span>sysctl <span class="nt">-ar</span> icmp
net.ipv4.icmp_echo_ignore_all <span class="o">=</span> 0
net.ipv4.icmp_echo_ignore_broadcasts <span class="o">=</span> 1
net.ipv4.icmp_errors_use_inbound_ifaddr <span class="o">=</span> 0
net.ipv4.icmp_ignore_bogus_error_responses <span class="o">=</span> 1
net.ipv4.icmp_msgs_burst <span class="o">=</span> 50
net.ipv4.icmp_msgs_per_sec <span class="o">=</span> 1000
net.ipv4.icmp_ratelimit <span class="o">=</span> 1000
net.ipv4.icmp_ratemask <span class="o">=</span> 6168
net.ipv4.vs.nat_icmp_send <span class="o">=</span> 0
net.ipv4.vs.schedule_icmp <span class="o">=</span> 0
net.ipv6.icmp.echo_ignore_all <span class="o">=</span> 0
net.ipv6.icmp.echo_ignore_anycast <span class="o">=</span> 0
net.ipv6.icmp.echo_ignore_multicast <span class="o">=</span> 0
net.ipv6.icmp.ratelimit <span class="o">=</span> 1000
net.ipv6.icmp.ratemask <span class="o">=</span> 0-1,3-127
net.netfilter.nf_conntrack_icmp_timeout <span class="o">=</span> 30
net.netfilter.nf_conntrack_icmpv6_timeout <span class="o">=</span> 30</code></pre></figure>

<p>پارامتری که ما نیاز داریم در این موقعیت<code class="highlighter-rouge">icmp_echo_ignore_all</code>است. که مقدار 0 است یعنی این قابلیت غیر فعال است و نیاز داریم که فعال شود. پس کافی است مقدار را به تغییر میدهیم :</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"> 
<span class="nv">$ </span><span class="nb">sudo </span>sysctl <span class="nt">-w</span> net.ipv4.icmp_echo_ignore_all<span class="o">=</span>1
net.ipv4.icmp_ehco_ignore_all <span class="o">=</span> 1</code></pre></figure>

<p>حال در سیستم هیچ پکت<code class="highlighter-rouge">ICMP</code>پاسخ داده نمی‌شود. همچنان اگر بخواهیم این تغییر بافی بماند میتوانیم در مسیر<code class="highlighter-rouge">/etc/sysctl.d</code>یک فایل با مقدار مورد نظر ایجاد کنیم.</p>

<p>این بود آنچه که برای محکم کاری و کوک کردن کرنل باید بدانیم همچنان مطالب بسیار بیشتر و پیشرفته تری در نسخه<a href="https://github.com/eqba1/LinuxHostSecurity/tree/main/madule1"> PDF’s</a> انگلیسی که در صفحه گیت هاب دوره قرار داده شده وجود دارد.
در ماژول بعدی سراغ نظارت کردن بر پورت ها و سرویس ها در لینوکس خواهیم رفت و بررسی امنیت این بخش را هم انجام میدهیم. پس تا ماژول بعد :)</p>

<div class="embed-responsive embed-responsive-16by9">
<iframe src="https://youtu.be/_a87d6l7XSA" allowfullscreen=""> قسمت اول آموزش امنیت در لینوکس </iframe>
</div>

            </div>
        </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=+%DA%A9%D9%88%DA%A9+%DA%A9%D8%B1%D8%AF%D9%86+%D9%87%D8%B3%D8%AA%D9%87+%D9%84%DB%8C%D9%86%D9%88%DA%A9%D8%B3+...%20-%20https://eqba1.github.com/posts/tuning-linux-kernel-with-sysctl%20by%20@_eqba1" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://eqba1.github.com/posts/tuning-linux-kernel-with-sysctl" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://eqba1-github-com.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
  <p>
      powerd by <a href="https://github.com/eqba1">github</a>
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-180543596-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-180543596-1');
  </script>


<script src="/assets/vendor-130c9c254effc51f3283620bc635851da7b99c20901216948f11ba72ee13317f.js" type="text/javascript"></script>




  <script src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js" type="text/javascript"></script>


<script src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>


  <script src="/assets/themetoggle-df0d3d73164dc26dffbd630182ae4d0dfa7bee6b694a2b5d565d73595b582bbf.js" type="text/javascript"></script>

</body>
</html>
